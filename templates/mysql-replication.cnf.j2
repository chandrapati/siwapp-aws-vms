# MySQL Replication Configuration
# Generated by Ansible

[mysqld]
# Server ID (unique for each server)
{% if 'Lead' in ansible_local.tags | default({}) or ansible_hostname == 'db1' %}
server-id = 1
{% elif ansible_hostname == 'db2' %}
server-id = 2
{% elif ansible_hostname == 'db3' %}
server-id = 3
{% else %}
server-id = {{ 100 + groups['vm_tag_db'].index(inventory_hostname) }}
{% endif %}

# Binary logging (required for replication)
log_bin = /var/log/mysql/mysql-bin.log
binlog_do_db = siwapp
binlog_format = mixed
expire_logs_days = 7
max_binlog_size = 100M

# Relay logs (for slaves)
relay-log = /var/log/mysql/mysql-relay-bin
relay-log-index = /var/log/mysql/mysql-relay-bin.index

# Networking
bind-address = 0.0.0.0

# InnoDB Settings
innodb_buffer_pool_size = 512M
innodb_log_file_size = 128M
innodb_flush_method = O_DIRECT

# General Settings
max_connections = 200
thread_cache_size = 8
query_cache_size = 32M
query_cache_limit = 2M

# Slow Query Log
slow_query_log = 1
slow_query_log_file = /var/log/mysql/mysql-slow.log
long_query_time = 2
